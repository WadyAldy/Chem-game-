<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkNoZW1SYWNlIC0gT3JnYW5pYyBDaGVtaXN0cnkgQmF0dGxlIiwKICAic2hvcnRfbmFtZSI6ICJDaGVtUmFjZSIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzY2N2VlYSIsCiAgInRoZW1lX2NvbG9yIjogIiM2NjdlZWEiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmclMjB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnJTIwd2lkdGg9JzE5MicgaGVpZ2h0PScxOTInJTNFJTNDcmVjdCUyMHdpZHRoPScxOTInJTIwaGVpZ2h0PScxOTInJTIwZmlsbD0nJTIzNjY3ZWVhJy8lM0UlM0N0ZXh0JTIweD0nNTAlMjUnJTIweT0nNTAlMjUnJTIwZm9udC1zaXplPSc5MCclMjBmb250LWZhbWlseT0nQXJpYWwnJTIwZmlsbD0nd2hpdGUnJTIwdGV4dC1hbmNob3I9J21pZGRsZSclMjBkb21pbmFudC1iYXNlbGluZT0nbWlkZGxlJyUzRSVFMiU5QSU5NyVFRiVCOCU4RiUzQy90ZXh0JTNFJTNDL3N2ZyUzRSIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyUyMHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyclMjB3aWR0aD0nNTEyJyUyMGhlaWdodD0nNTEyJyUzRSUzQ3JlY3QlMjB3aWR0aD0nNTEyJyUyMGhlaWdodD0nNTEyJyUyMGZpbGw9JyUyMzY2N2VlYScvJTNFJTNDdGV4dCUyMHg9JzUwJTI1JyUyMHk9JzUwJTI1JyUyMGZvbnQtc2l6ZT0nMjQwJyUyMGZvbnQtZmFtaWx5PSdBcmlhbCclMjBmaWxsPSd3aGl0ZSclMjB0ZXh0LWFuY2hvcj0nbWlkZGxlJyUyMGRvbWluYW50LWJhc2VsaW5lPSdtaWRkbGUnJTNFJUUyJTlBJTk3JUVGJUI4JThGJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js" crossorigin="anonymous"></script>
    <title>ChemRace - Organic Chemistry Battle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 10px;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            overflow-x: hidden;
            overflow-y: auto;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
            overflow: visible;
            min-height: 400px;
            margin: 20px 0;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
            border-radius: 20px 20px 0 0;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 0.95em;
            opacity: 0.9;
        }

        .lobby-screen, .game-screen, .results-screen {
            padding: 20px 15px;
            min-height: 300px;
        }

        .lobby-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .input-group {
            flex: 1;
            min-width: 250px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 16px 28px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            min-height: 48px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 5px;
        }

        .btn-primary:active, .btn-success:active {
            transform: scale(0.95);
        }

        .hidden {
            display: none !important;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(56, 239, 125, 0.4);
        }

        .waiting-room {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
            display: block;
        }

        .waiting-room.hidden {
            display: none;
        }

        .waiting-room h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .players-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .player-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .player-card.host {
            border-left-color: #ffd700;
        }

        .player-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .player-badge {
            display: inline-block;
            padding: 3px 8px;
            background: #667eea;
            color: white;
            border-radius: 4px;
            font-size: 12px;
        }

        .game-board {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .compound-display {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .compound-display h3 {
            margin-bottom: 15px;
            color: #667eea;
        }

        .compound {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            padding: 20px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }

        .timer-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, #11998e 0%, #38ef7d 100%);
            transition: width 0.3s ease;
        }

        .timer-fill.warning {
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
        }

        .reaction-steps {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
        }

        .reaction-steps h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .step-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .step-card .step-number {
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .step-content {
            flex: 1;
            font-weight: 500;
        }

        .reagent-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .reagent-card {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .reagent-card:active {
            transform: scale(0.95);
        }

        .reagent-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .reagent-card.selected {
            border-color: #38ef7d;
            background: #e8f9f0;
        }

        .reagent-card.correct {
            border-color: #38ef7d;
            background: #d4f4e3;
        }

        .reagent-card.incorrect {
            border-color: #f5576c;
            background: #ffe5e8;
        }

        .reagent-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .reagent-formula {
            color: #666;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .scoreboard {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .scoreboard h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .score-item.current-player {
            border: 2px solid #667eea;
        }

        .score-name {
            font-weight: 600;
            color: #333;
        }

        .score-value {
            font-weight: bold;
            color: #667eea;
            font-size: 1.2em;
        }

        .hidden {
            display: none;
        }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
            text-align: center;
        }

        .feedback.success {
            background: #d4f4e3;
            color: #0f6938;
        }

        .feedback.error {
            background: #ffe5e8;
            color: #c41e3a;
        }

        .feedback strong {
            font-weight: 700;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .final-results {
            text-align: center;
        }

        .podium {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }

        .podium-place {
            background: white;
            padding: 30px;
            border-radius: 12px;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .podium-place.first {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            transform: translateY(-10px);
        }

        .podium-place.second {
            background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
        }

        .podium-place.third {
            background: linear-gradient(135deg, #cd7f32 0%, #e8a76f 100%);
        }

        .place-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .place-name {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .place-score {
            font-size: 1.1em;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .podium {
                flex-direction: column;
                align-items: center;
            }

            .header h1 {
                font-size: 1.6em;
            }

            .header p {
                font-size: 0.85em;
            }

            .compound {
                font-size: 1.4em;
                padding: 15px;
            }

            .reagent-options {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .reagent-card {
                padding: 18px;
            }

            .lobby-controls {
                flex-direction: column;
            }

            .input-group {
                min-width: 100%;
            }

            .game-info {
                flex-wrap: wrap;
                gap: 10px;
            }

            .info-item {
                flex: 1;
                min-width: 80px;
            }

            .info-value {
                font-size: 1.2em;
            }

            .btn {
                width: 100%;
                margin-bottom: 10px;
            }

            .lobby-screen, .game-screen, .results-screen {
                padding: 15px 10px;
            }

            .players-list {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.4em;
            }

            .compound {
                font-size: 1.2em;
            }

            .reagent-name {
                font-size: 1em;
            }

            .reagent-formula {
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>‚öóÔ∏è ChemRace</h1>
            <p>Master Organic Chemistry Reactions - JEE Edition</p>
            <div id="connectionStatus" style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                <span id="statusIndicator">üî¥ Connecting...</span>
            </div>
        </div>

        <!-- Lobby Screen -->
        <div id="lobbyScreen" class="lobby-screen">
            <div id="loadingIndicator" style="text-align: center; padding: 40px;">
                <div style="font-size: 2em; margin-bottom: 20px;">‚öóÔ∏è</div>
                <div style="font-size: 1.2em; color: #667eea;">Loading ChemRace...</div>
            </div>
            
            <div id="lobbyContent" style="display: none;">
                <div class="lobby-controls">
                    <div class="input-group">
                        <label for="playerName">Your Name</label>
                        <input type="text" id="playerName" placeholder="Enter your name" maxlength="20">
                    </div>
                    <div class="input-group">
                        <label for="difficultySelect">Difficulty Level</label>
                        <select id="difficultySelect">
                            <option value="easy">Easy - Basic Reactions</option>
                            <option value="medium" selected>Medium - JEE Mains</option>
                            <option value="hard">Hard - JEE Advanced</option>
                        </select>
                    </div>
                </div>
                <div style="text-align: center; margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="game.createRoom()">Create Room</button>
                    <button class="btn btn-success" onclick="game.quickPlay()">Quick Play (Solo)</button>
                    <button class="btn btn-primary" onclick="game.showJoinRoom()" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">Join Room</button>
                    <button id="testSocketBtn" class="btn" onclick="game.testSocket()" style="background: #ffa500; color: white; font-size: 0.9em; padding: 12px 20px;">üîß Test Connection</button>
                    <button id="installBtn" class="btn btn-primary hidden" onclick="game.installApp()" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">üì± Install App</button>
                </div>

                <div id="joinRoomModal" class="waiting-room hidden">
                    <h3>Join a Room</h3>
                    <div class="input-group" style="margin-bottom: 15px;">
                        <label for="joinRoomCode">Room Code</label>
                        <input type="text" id="joinRoomCode" placeholder="Enter room code (e.g., CHEM1234)" maxlength="8" style="text-transform: uppercase;">
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-success" onclick="game.joinRoom()">Join Room</button>
                        <button class="btn" onclick="game.hideJoinRoom()" style="background: #e0e0e0; color: #333;">Cancel</button>
                    </div>
                </div>

                <div id="waitingRoom" class="waiting-room hidden">
                    <h3>Waiting Room</h3>
                    <div id="roomCode" style="font-size: 1.5em; font-weight: bold; color: #667eea; margin-bottom: 20px;"></div>
                    <div class="players-list" id="playersList"></div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="game.startGame()">Start Game</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="game-screen hidden">
            <div class="timer-bar">
                <div id="timerFill" class="timer-fill" style="width: 100%;"></div>
            </div>

            <div class="game-info">
                <div class="info-item">
                    <div class="info-label">Round</div>
                    <div class="info-value" id="roundNumber">1/5</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Your Score</div>
                    <div class="info-value" id="playerScore">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Time Left</div>
                    <div class="info-value" id="timeLeft">30s</div>
                </div>
            </div>

            <div id="feedbackMessage" class="feedback hidden"></div>

            <div class="game-board">
                <div class="compound-display">
                    <h3>Starting Compound</h3>
                    <div class="compound" id="startCompound">CH‚ÇÉCH‚ÇÇOH</div>
                    <small style="color: #666;">Ethanol</small>
                </div>
                <div class="compound-display">
                    <h3>Target Compound</h3>
                    <div class="compound" id="targetCompound">CH‚ÇÉCHO</div>
                    <small style="color: #666;">Ethanal</small>
                </div>
            </div>

            <div class="reaction-steps">
                <h3>Choose the Correct Reagent/Mechanism:</h3>
                <div id="currentStepInfo" style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px;">
                    <strong>Step <span id="stepNumber">1</span>:</strong> <span id="stepDescription">Select the appropriate oxidizing agent</span>
                </div>

                <div class="reagent-options" id="reagentOptions">
                    <!-- Reagent cards will be populated here -->
                </div>
            </div>

            <div class="scoreboard">
                <h3>Live Scoreboard</h3>
                <div id="liveScores"></div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="results-screen hidden">
            <div class="final-results">
                <h2 style="margin-bottom: 30px; color: #333;">Game Over!</h2>
                <div class="podium" id="podium"></div>
                <button class="btn btn-primary" onclick="game.returnToLobby()">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // PWA Installation for Android
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Show install button
            const installBtn = document.getElementById('installBtn');
            if (installBtn) {
                installBtn.classList.remove('hidden');
            }
        });

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgKGUpID0+IHsKICBzZWxmLnNraXBXYWl0aW5nKCk7Cn0pOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIChlKSA9PiB7CiAgZS5yZXNwb25kV2l0aCgKICAgIGZldGNoKGUucmVxdWVzdCkuY2F0Y2goKCkgPT4gY2FjaGVzLm1hdGNoKGUucmVxdWVzdCkpCiAgKTsKfSk7')
                    .catch(() => {});
            });
        }

        // Socket.IO Connection (with fallback for local testing)
        let socket = null;
        
        // Wait for page to load before initializing socket
        window.addEventListener('DOMContentLoaded', () => {
            try {
                if (typeof io !== 'undefined') {
                    socket = io();
                    
                    socket.on('connect', () => {
                        console.log('‚úÖ Connected to server');
                        console.log('Socket ID:', socket.id);
                        console.log('Transport:', socket.io.engine.transport.name);
                        const indicator = document.getElementById('statusIndicator');
                        if (indicator) indicator.innerHTML = 'üü¢ Connected (ID: ' + socket.id.substring(0, 6) + '...)';
                    });

                    socket.on('connectionConfirmed', (data) => {
                        console.log('‚úÖ Server confirmation received:', data);
                    });

                    socket.on('disconnect', () => {
                        console.log('Disconnected from server');
                        const indicator = document.getElementById('statusIndicator');
                        if (indicator) indicator.innerHTML = 'üî¥ Disconnected';
                    });

                    socket.on('connect_error', (error) => {
                        console.error('Connection error:', error);
                        const indicator = document.getElementById('statusIndicator');
                        if (indicator) indicator.innerHTML = 'üî¥ Connection Failed - Solo Mode Only';
                    });

                    socket.on('error', (data) => {
                        alert(data.message);
                    });
                } else {
                    console.warn('Socket.IO not loaded');
                    const indicator = document.getElementById('statusIndicator');
                    if (indicator) indicator.innerHTML = 'üü° Solo Mode Only';
                }
            } catch (e) {
                console.error('Socket initialization error:', e);
                const indicator = document.getElementById('statusIndicator');
                if (indicator) indicator.innerHTML = 'üü° Solo Mode Only';
            }
        });

        });

        // Game State Management
        class ChemRaceGame {
            constructor() {
                this.players = [];
                this.currentPlayer = null;
                this.currentRound = 0;
                this.totalRounds = 5;
                this.timePerRound = 30;
                this.currentQuestion = null;
                this.scores = {};
                this.timer = null;
                this.timeLeft = this.timePerRound;
                this.difficulty = 'medium';
                this.isHost = false;
                this.roomCode = null;
                this.isMultiplayer = false;
                this.socket = socket;
                
                console.log('Game constructor - socket:', this.socket ? 'available' : 'null');
                
                if (this.socket) {
                    console.log('Setting up socket listeners');
                    this.setupSocketListeners();
                } else {
                    console.warn('No socket available - multiplayer disabled');
                }
                
                // JEE Organic Chemistry Question Bank - 100+ Reactions
                this.questionBank = {
                    easy: [
                        // Basic Oxidation-Reduction
                        {
                            start: 'CH‚ÇÉCH‚ÇÇOH',
                            startName: 'Ethanol',
                            target: 'CH‚ÇÉCHO',
                            targetName: 'Ethanal',
                            steps: [{ correct: 'PCC', options: [{ name: 'PCC', formula: 'C‚ÇÖH‚ÇÖNHCrO‚ÇÉCl' }, { name: 'KMnO‚ÇÑ', formula: 'KMnO‚ÇÑ' }, { name: 'K‚ÇÇCr‚ÇÇO‚Çá/H‚Å∫', formula: 'Acidic dichromate' }, { name: 'CrO‚ÇÉ', formula: 'Chromium trioxide' }] }]
                        },
                        {
                            start: 'CH‚ÇÉCHO',
                            startName: 'Acetaldehyde',
                            target: 'CH‚ÇÉCH‚ÇÇOH',
                            targetName: 'Ethanol',
                            steps: [{ correct: 'NaBH‚ÇÑ', options: [{ name: 'NaBH‚ÇÑ', formula: 'Sodium borohydride' }, { name: 'LiAlH‚ÇÑ', formula: 'Lithium aluminum hydride' }, { name: 'H‚ÇÇ/Ni', formula: 'Catalytic hydrogenation' }, { name: 'Zn/HCl', formula: 'Zinc amalgam' }] }]
                        },
                        {
                            start: 'CH‚ÇÉCOOH',
                            startName: 'Acetic Acid',
                            target: 'CH‚ÇÉCH‚ÇÇOH',
                            targetName: 'Ethanol',
                            steps: [{ correct: 'LiAlH‚ÇÑ', options: [{ name: 'LiAlH‚ÇÑ', formula: 'LAH' }, { name: 'NaBH‚ÇÑ', formula: 'Sodium borohydride' }, { name: 'H‚ÇÇ/Pt', formula: 'Catalytic reduction' }, { name: 'Zn/HCl', formula: 'Zinc/acid' }] }]
                        },
                        {
                            start: 'CH‚ÇÉCH‚ÇÇOH',
                            startName: 'Ethanol',
                            target: 'CH‚ÇÉCOOH',
                            targetName: 'Acetic Acid',
                            steps: [{ correct: 'K‚ÇÇCr‚ÇÇO‚Çá/H‚ÇÇSO‚ÇÑ', options: [{ name: 'K‚ÇÇCr‚ÇÇO‚Çá/H‚ÇÇSO‚ÇÑ', formula: 'Acidic dichromate' }, { name: 'PCC', formula: 'Mild oxidant' }, { name: 'KMnO‚ÇÑ/OH‚Åª', formula: 'Alkaline permanganate' }, { name: 'CrO‚ÇÉ/H‚Å∫', formula: 'Jones reagent' }] }]
                        },
                        // Halogenation
                        {
                            start: 'C‚ÇÜH‚ÇÜ',
                            startName: 'Benzene',
                            target: 'C‚ÇÜH‚ÇÖBr',
                            targetName: 'Bromobenzene',
                            steps: [{ correct: 'Br‚ÇÇ/FeBr‚ÇÉ', options: [{ name: 'Br‚ÇÇ/FeBr‚ÇÉ', formula: 'Lewis acid catalyst' }, { name: 'Br‚ÇÇ/AlBr‚ÇÉ', formula: 'Aluminum catalyst' }, { name: 'HBr', formula: 'Hydrogen bromide' }, { name: 'NaBr', formula: 'Sodium bromide' }] }]
                        },
                        {
                            start: 'C‚ÇÜH‚ÇÜ',
                            startName: 'Benzene',
                            target: 'C‚ÇÜH‚ÇÖCl',
                            targetName: 'Chlorobenzene',
                            steps: [{ correct: 'Cl‚ÇÇ/FeCl‚ÇÉ', options: [{ name: 'Cl‚ÇÇ/FeCl‚ÇÉ', formula: 'Iron(III) chloride' }, { name: 'Cl‚ÇÇ/AlCl‚ÇÉ', formula: 'Aluminum chloride' }, { name: 'HCl', formula: 'Hydrogen chloride' }, { name: 'SOCl‚ÇÇ', formula: 'Thionyl chloride' }] }]
                        },
                        {
                            start: 'C‚ÇÜH‚ÇÜ',
                            startName: 'Benzene',
                            target: 'C‚ÇÜH‚ÇÖNO‚ÇÇ',
                            targetName: 'Nitrobenzene',
                            steps: [{ correct: 'HNO‚ÇÉ/H‚ÇÇSO‚ÇÑ', options: [{ name: 'HNO‚ÇÉ/H‚ÇÇSO‚ÇÑ', formula: 'Nitrating mixture' }, { name: 'NaNO‚ÇÇ', formula: 'Sodium nitrite' }, { name: 'NH‚ÇÉ', formula: 'Ammonia' }, { name: 'N‚ÇÇO‚ÇÖ', formula: 'Dinitrogen pentoxide' }] }]
                        },
                        // Addition Reactions
                        {
                            start: 'CH‚ÇÇ=CH‚ÇÇ',
                            startName: 'Ethene',
                            target: 'CH‚ÇÉCH‚ÇÇBr',
                            targetName: 'Bromoethane',
                            steps: [{ correct: 'HBr', options: [{ name: 'HBr', formula: 'Hydrogen bromide' }, { name: 'Br‚ÇÇ', formula: 'Bromine' }, { name: 'NaBr', formula: 'Sodium bromide' }, { name: 'Br‚ÇÇ/CCl‚ÇÑ', formula: 'Bromine in CCl‚ÇÑ' }] }]
                        },
                        {
                            start: 'CH‚ÇÇ=CH‚ÇÇ',
                            startName: 'Ethene',
                            target: 'CH‚ÇÉCH‚ÇÇOH',
                            targetName: 'Ethanol',
                            steps: [{ correct: 'H‚ÇÇO/H‚ÇÇSO‚ÇÑ', options: [{ name: 'H‚ÇÇO/H‚ÇÇSO‚ÇÑ', formula: 'Acid-catalyzed hydration' }, { name: 'H‚ÇÇO/NaOH', formula: 'Base hydration' }, { name: 'KOH/H‚ÇÇO', formula: 'Alkaline hydration' }, { name: 'H‚ÇÇO‚ÇÇ', formula: 'Hydrogen peroxide' }] }]
                        },
                        {
                            start: 'CH‚ÇÇ=CH‚ÇÇ',
                            startName: 'Ethene',
                            target: 'CH‚ÇÇBrCH‚ÇÇBr',
                            targetName: '1,2-Dibromoethane',
                            steps: [{ correct: 'Br‚ÇÇ/CCl‚ÇÑ', options: [{ name: 'Br‚ÇÇ/CCl‚ÇÑ', formula: 'Bromine in CCl‚ÇÑ' }, { name: 'HBr', formula: 'Hydrogen bromide' }, { name: 'Br‚ÇÇ/FeBr‚ÇÉ', formula: 'Catalyzed bromination' }, { name: 'NaBr', formula: 'Sodium bromide' }] }]
                        },
                        // Substitution
                        {
                            start: 'CH‚ÇÉBr',
                            startName: 'Methyl bromide',
                            target: 'CH‚ÇÉOH',
                            targetName: 'Methanol',
                            steps: [{ correct: 'KOH(aq)', options: [{ name: 'KOH(aq)', formula: 'Aqueous potassium hydroxide' }, { name: 'NaOH(alc)', formula: 'Alcoholic sodium hydroxide' }, { name: 'H‚ÇÇO', formula: 'Water' }, { name: 'NaCl', formula: 'Sodium chloride' }] }]
                        },
                        {
                            start: 'CH‚ÇÉCH‚ÇÇBr',
                            startName: 'Ethyl bromide',
                            target: 'CH‚ÇÉCH‚ÇÇCN',
                            targetName: 'Propionitrile',
                            steps: [{ correct: 'KCN/EtOH', options: [{ name: 'KCN/EtOH', formula: 'Alcoholic KCN' }, { name: 'NaCN/H‚ÇÇO', formula: 'Aqueous NaCN' }, { name: 'AgCN', formula: 'Silver cyanide' }, { name: 'HCN', formula: 'Hydrogen cyanide' }] }]
                        },
                        // Dehydration
                        {
                            start: 'CH‚ÇÉCH‚ÇÇOH',
                            startName: 'Ethanol',
                            target: 'CH‚ÇÇ=CH‚ÇÇ',
                            targetName: 'Ethene',
                            steps: [{ correct: 'H‚ÇÇSO‚ÇÑ, 170¬∞C', options: [{ name: 'H‚ÇÇSO‚ÇÑ, 170¬∞C', formula: 'Conc. sulfuric acid, heat' }, { name: 'H‚ÇÇSO‚ÇÑ, 140¬∞C', formula: 'Lower temp sulfuric acid' }, { name: 'NaOH', formula: 'Sodium hydroxide' }, { name: 'HCl', formula: 'Hydrochloric acid' }] }]
                        },
                        {
                            start: 'CH‚ÇÉCH‚ÇÇOH',
                            startName: 'Ethanol',
                            target: 'CH‚ÇÉOCH‚ÇÉ',
                            targetName: 'Dimethyl ether',
                            steps: [{ correct: 'H‚ÇÇSO‚ÇÑ, 140¬∞C', options: [{ name: 'H‚ÇÇSO‚ÇÑ, 140¬∞C', formula: 'Moderate heating' }, { name: 'H‚ÇÇSO‚ÇÑ, 170¬∞C', formula: 'High temp dehydration' }, { name: 'Al‚ÇÇO‚ÇÉ, heat', formula: 'Alumina catalyst' }, { name: 'NaOH', formula: 'Base' }] }]
                        },
                        // Esterification
                        {
                            start: 'CH‚ÇÉCOOH + CH‚ÇÉOH',
                            startName: 'Acetic acid + Methanol',
                            target: 'CH‚ÇÉCOOCH‚ÇÉ',
                            targetName: 'Methyl acetate',
                            steps: [{ correct: 'H‚ÇÇSO‚ÇÑ (cat)', options: [{ name: 'H‚ÇÇSO‚ÇÑ (cat)', formula: 'Acid catalyst' }, { name: 'NaOH', formula: 'Base' }, { name: 'HCl', formula: 'Hydrogen chloride' }, { name: 'KOH', formula: 'Potassium hydroxide' }] }]
                        }
                    ],
                    medium: [
                        // Multi-step conversions
                        {
                            start: 'CH‚ÇÑ',
                            startName: 'Methane',
                            target: 'CH‚ÇÉCl',
                            targetName: 'Chloromethane',
                            steps: [
                                { correct: 'Cl‚ÇÇ/hv', options: [{ name: 'Cl‚ÇÇ/hv', formula: 'Chlorine + light' }, { name: 'Cl‚ÇÇ/dark', formula: 'Chlorine without light' }, { name: 'HCl', formula: 'Hydrogen chloride' }, { name: 'NaCl', formula: 'Sodium chloride' }] }
                            ]
                        },
                        {
                            start: 'CH‚ÇÉCH‚ÇÇBr',
                            startName: 'Ethyl bromide',
                            target: 'CH‚ÇÉCH‚ÇÇNH‚ÇÇ',
                            targetName: 'Ethylamine',
                            steps: [
                                { correct: 'Gabriel phthalimide synthesis', options: [{ name: 'Gabriel phthalimide synthesis', formula: 'Phthalimide/KOH' }, { name: 'NH‚ÇÉ', formula: 'Ammonia' }, { name: 'NaNH‚ÇÇ', formula: 'Sodium amide' }, { name: 'HNO‚ÇÉ', formula: 'Nitric acid' }] }
                            ]
                        },
                        {
                            start: 'C‚ÇÜH‚ÇÖNH‚ÇÇ',
                            startName: 'Aniline',
                            target: 'C‚ÇÜH‚ÇÖN‚ÇÇ‚Å∫Cl‚Åª',
                            targetName: 'Benzenediazonium chloride',
                            steps: [{ correct: 'NaNO‚ÇÇ/HCl, 0-5¬∞C', options: [{ name: 'NaNO‚ÇÇ/HCl, 0-5¬∞C', formula: 'Diazotization' }, { name: 'HNO‚ÇÉ/H‚ÇÇSO‚ÇÑ', formula: 'Nitrating mixture' }, { name: 'NaNO‚ÇÇ/H‚ÇÇSO‚ÇÑ', formula: 'Wrong acid' }, { name: 'KNO‚ÇÉ/HCl', formula: 'Wrong nitrite' }] }]
                        },
                        {
                            start: 'CH‚ÇÉCOCH‚ÇÉ',
                            startName: 'Acetone',
                            target: 'CH‚ÇÉCH(OH)CH‚ÇÉ',
                            targetName: 'Isopropanol',
                            steps: [{ correct: 'NaBH‚ÇÑ or LiAlH‚ÇÑ', options: [{ name: 'NaBH‚ÇÑ or LiAlH‚ÇÑ', formula: 'Reducing agents' }, { name: 'KMnO‚ÇÑ', formula: 'Oxidizing agent' }, { name: 'H‚ÇÇSO‚ÇÑ', formula: 'Acid' }, { name: 'PCC', formula: 'Mild oxidant' }] }]
                        },
                        {
                            start: 'C‚ÇÜH‚ÇÖNO‚ÇÇ',
                            startName: 'Nitrobenzene',
                            target: 'C‚ÇÜH‚ÇÖNH‚ÇÇ',
                            targetName: 'Aniline',
                            steps: [{ correct: 'Sn/HCl or Fe/HCl', options: [{ name: 'Sn/HCl or Fe/HCl', formula: 'Metal/acid reduction' }, { name: 'Zn/NaOH', formula: 'Zinc/base' }, { name: 'LiAlH‚ÇÑ', formula: 'LAH' }, { name: 'H‚ÇÇ/Pt', formula: 'Catalytic hydrogenation' }] }]
                        },
                        {
                            start: 'CH‚ÇÉCOOH',
                            startName: 'Acetic acid',
                            target: 'CH‚ÇÑ',
                            targetName: 'Methane',
                            steps: [{ correct: 'NaOH/CaO, Œî', options: [{ name: 'NaOH/CaO, Œî', formula: 'Soda lime decarboxylation' }, { name: 'LiAlH‚ÇÑ', formula: 'Reduction' }, { name: 'H‚ÇÇ/Ni', formula: 'Hydrogenation' }, { name: 'KOH', formula: 'Simple base' }] }]
                        },
                        // Named Mechanisms
                        {
                            start: 'CH‚ÇÉCHO',
                            startName: 'Acetaldehyde',
                            target: 'CH‚ÇÉCH(OH)CH‚ÇÇCHO',
                            targetName: 'Aldol product',
                            steps: [{ correct: 'Aldol condensation', options: [{ name: 'Aldol condensation', formula: 'Dil. NaOH' }, { name: 'Cannizzaro reaction', formula: 'Conc. NaOH' }, { name: 'Clemmensen reduction', formula: 'Zn-Hg/HCl' }, { name: 'Friedel-Crafts', formula: 'AlCl‚ÇÉ' }] }]
                        },
                        {
                            start: 'HCHO',
                            startName: 'Formaldehyde',
                            target: 'CH‚ÇÉOH + HCOONa',
                            targetName: 'Methanol + Sodium formate',
                            steps: [{ correct: 'Cannizzaro reaction', options: [{ name: 'Cannizzaro reaction', formula: 'Conc. NaOH' }, { name: 'Aldol condensation', formula: 'Dil. NaOH' }, { name: 'Wurtz reaction', formula: 'Na/ether' }, { name: 'Grignard reaction', formula: 'RMgX' }] }]
                        },
                        {
                            start: 'CH‚ÇÉCOCH‚ÇÉ + CHCl‚ÇÉ',
                            startName: 'Acetone + Chloroform',
                            target: 'CHCl‚ÇÉ derivative',
                            targetName: 'Chloroform test positive',
                            steps: [{ correct: 'Haloform reaction', options: [{ name: 'Haloform reaction', formula: 'NaOH + I‚ÇÇ' }, { name: 'Friedel-Crafts', formula: 'AlCl‚ÇÉ' }, { name: 'Williamson synthesis', formula: 'RX + OR‚Åª' }, { name: 'Sandmeyer reaction', formula: 'CuCl/HCl' }] }]
                        },
                        {
                            start: 'C‚ÇÜH‚ÇÖN‚ÇÇ‚Å∫Cl‚Åª',
                            startName: 'Benzenediazonium chloride',
                            target: 'C‚ÇÜH‚ÇÖCl',
                            targetName: 'Chlorobenzene',
                            steps: [{ correct: 'Sandmeyer reaction', options: [{ name: 'Sandmeyer reaction', formula: 'CuCl/HCl' }, { name: 'Gattermann reaction', formula: 'Cu/HCl' }, { name: 'Balz-Schiemann', formula: 'HBF‚ÇÑ' }, { name: 'Kolbe reaction', formula: 'CO‚ÇÇ' }] }]
                        },
                        {
                            start: 'C‚ÇÜH‚ÇÖOH + CHCl‚ÇÉ',
                            startName: 'Phenol + Chloroform',
                            target: 'C‚ÇÜH‚ÇÑ(OH)CHO',
                            targetName: 'Salicylaldehyde',
                            steps: [{ correct: 'Reimer-Tiemann reaction', options: [{ name: 'Reimer-Tiemann reaction', formula: 'CHCl‚ÇÉ/NaOH' }, { name: 'Kolbe-Schmitt', formula: 'CO‚ÇÇ/NaOH' }, { name: 'Friedel-Crafts', formula: 'AlCl‚ÇÉ' }, { name: 'Gattermann-Koch', formula: 'CO/HCl' }] }]
                        },
                        {
                            start: 'C‚ÇÜH‚ÇÖOH + CO‚ÇÇ',
                            startName: 'Phenol + Carbon dioxide',
                            target: 'C‚ÇÜH‚ÇÑ(OH)COOH',
                            targetName: 'Salicylic acid',
                            steps: [{ correct: 'Kolbe-Schmitt reaction', options: [{ name: 'Kolbe-Schmitt reaction', formula: 'CO‚ÇÇ/NaOH, 125¬∞C' }, { name: 'Reimer-Tiemann', formula: 'CHCl‚ÇÉ/NaOH' }, { name: 'Friedel-Crafts', formula: 'AlCl‚ÇÉ' }, { name: 'Gattermann', formula: 'HCN/HCl' }] }]
                        },
                        // Grignard reactions
                        {
                            start: 'CH‚ÇÉBr',
                            startName: 'Methyl bromide',
                            target: 'CH‚ÇÉMgBr',
                            targetName: 'Methylmagnesium bromide',
                            steps: [{ correct: 'Mg/dry ether', options: [{ name: 'Mg/dry ether', formula: 'Grignard prep' }, { name: 'Na/ether', formula: 'Sodium metal' }, { name: 'Mg/H‚ÇÇO', formula: 'With water' }, { name: 'Li/ether', formula: 'Lithium metal' }] }]
                        },
                        {
                            start: 'HCHO + CH‚ÇÉMgBr',
                            startName: 'Formaldehyde + Grignard',
                            target: 'CH‚ÇÉCH‚ÇÇOH',
                            targetName: 'Ethanol',
                            steps: [
                                { correct: 'H‚ÇÉO‚Å∫', options: [{ name: 'H‚ÇÉO‚Å∫', formula: 'Acid workup' }, { name: 'NaOH', formula: 'Base' }, { name: 'H‚ÇÇO', formula: 'Plain water' }, { name: 'NH‚ÇÉ', formula: 'Ammonia' }] }
                            ]
                        },
                        // Elimination reactions
                        {
                            start: 'CH‚ÇÉCH‚ÇÇBr',
                            startName: 'Ethyl bromide',
                            target: 'CH‚ÇÇ=CH‚ÇÇ',
                            targetName: 'Ethene',
                            steps: [{ correct: 'KOH(alc), heat', options: [{ name: 'KOH(alc), heat', formula: 'Alcoholic base' }, { name: 'KOH(aq)', formula: 'Aqueous base' }, { name: 'NaCl', formula: 'Sodium chloride' }, { name: 'H‚ÇÇO', formula: 'Water' }] }]
                        },
                        {
                            start: 'CH‚ÇÉCHBrCH‚ÇÉ',
                            startName: '2-Bromopropane',
                            target: 'CH‚ÇÉCH=CH‚ÇÇ',
                            targetName: 'Propene',
                            steps: [{ correct: 'NaOH(alc), Œî', options: [{ name: 'NaOH(alc), Œî', formula: 'E2 elimination' }, { name: 'NaOH(aq)', formula: 'Substitution' }, { name: 'H‚ÇÇSO‚ÇÑ', formula: 'Acid' }, { name: 'KCN', formula: 'Cyanide' }] }]
                        },
                        // Oxidation variations
                        {
                            start: 'CH‚ÇÉCH(OH)CH‚ÇÉ',
                            startName: '2-Propanol',
                            target: 'CH‚ÇÉCOCH‚ÇÉ',
                            targetName: 'Acetone',
                            steps: [{ correct: 'K‚ÇÇCr‚ÇÇO‚Çá/H‚Å∫', options: [{ name: 'K‚ÇÇCr‚ÇÇO‚Çá/H‚Å∫', formula: 'Chromic acid' }, { name: 'LiAlH‚ÇÑ', formula: 'Reducing agent' }, { name: 'NaBH‚ÇÑ', formula: 'Mild reducer' }, { name: 'H‚ÇÇ/Ni', formula: 'Hydrogenation' }] }]
                        },
                        {
                            start: 'C‚ÇÜH‚ÇÖCH‚ÇÉ',
                            startName: 'Toluene',
                            target: 'C‚ÇÜH‚ÇÖCOOH',
                            targetName: 'Benzoic acid',
                            steps: [{ correct: 'KMnO‚ÇÑ/H‚Å∫, Œî', options: [{ name: 'KMnO‚ÇÑ/H‚Å∫, Œî', formula: 'Strong oxidation' }, { name: 'PCC', formula: 'Mild oxidant' }, { name: 'LiAlH‚ÇÑ', formula: 'Reducer' }, { name: 'H‚ÇÇ/Pd', formula: 'Hydrogenation' }] }]
                        },
                        {
                            start: 'CH‚ÇÉCH‚ÇÇCH‚ÇÇOH',
                            startName: '1-Propanol',
                            target: 'CH‚ÇÉCH‚ÇÇCHO',
                            targetName: 'Propanal',
                            steps: [{ correct: 'PCC or PDC', options: [{ name: 'PCC or PDC', formula: 'Mild oxidants' }, { name: 'K‚ÇÇCr‚ÇÇO‚Çá/H‚Å∫', formula: 'Strong oxidant' }, { name: 'KMnO‚ÇÑ', formula: 'Over-oxidation' }, { name: 'NaBH‚ÇÑ', formula: 'Reducer' }] }]
                        },
                        // Williamson synthesis
                        {
                            start: 'C‚ÇÜH‚ÇÖOH + CH‚ÇÉI',
                            startName: 'Phenol + Methyl iodide',
                            target: 'C‚ÇÜH‚ÇÖOCH‚ÇÉ',
                            targetName: 'Anisole',
                            steps: [{ correct: 'Williamson synthesis', options: [{ name: 'Williamson synthesis', formula: 'NaOH/heat' }, { name: 'Friedel-Crafts', formula: 'AlCl‚ÇÉ' }, { name: 'Wurtz reaction', formula: 'Na/ether' }, { name: 'Sandmeyer', formula: 'CuCl' }] }]
                        },
                        {
                            start: 'CH‚ÇÉCH‚ÇÇOH + CH‚ÇÉBr',
                            startName: 'Ethanol + Methyl bromide',
                            target: 'CH‚ÇÉOCH‚ÇÇCH‚ÇÉ',
                            targetName: 'Ethyl methyl ether',
                            steps: [
                                { correct: 'Na metal', options: [{ name: 'Na metal', formula: 'Form ethoxide first' }, { name: 'NaOH', formula: 'Weak base' }, { name: 'KOH', formula: 'Potassium hydroxide' }, { name: 'NaCl', formula: 'Salt' }] },
                                { correct: 'Then CH‚ÇÉBr', options: [{ name: 'Then CH‚ÇÉBr', formula: 'SN2 reaction' }, { name: 'H‚ÇÇSO‚ÇÑ', formula: 'Acid' }, { name: 'HCl', formula: 'Hydrogen chloride' }, { name: 'Br‚ÇÇ', formula: 'Bromine' }] }
                            ]
                        },
                        // Friedel-Crafts
                        {
                            start: 'C‚ÇÜH‚ÇÜ + CH‚ÇÉCl',
                            startName: 'Benzene + Methyl chloride',
                            target: 'C‚ÇÜH‚ÇÖCH‚ÇÉ',
                            targetName: 'Toluene',
                            steps: [{ correct: 'Friedel-Crafts alkylation', options: [{ name: 'Friedel-Crafts alkylation', formula: 'AlCl‚ÇÉ' }, { name: 'Wurtz reaction', formula: 'Na/ether' }, { name: 'Grignard', formula: 'Mg/ether' }, { name: 'Sandmeyer', formula: 'CuCl' }] }]
                        },
                        {
                            start: 'C‚ÇÜH‚ÇÜ + CH‚ÇÉCOCl',
                            startName: 'Benzene + Acetyl chloride',
                            target: 'C‚ÇÜH‚ÇÖCOCH‚ÇÉ',
                            targetName: 'Acetophenone',
                            steps: [{ correct: 'Friedel-Crafts acylation', options: [{ name: 'Friedel-Crafts acylation', formula: 'AlCl‚ÇÉ' }, { name: 'Gattermann-Koch', formula: 'CO/HCl/AlCl‚ÇÉ' }, { name: 'Reimer-Tiemann', formula: 'CHCl‚ÇÉ/NaOH' }, { name: 'Kolbe', formula: 'CO‚ÇÇ' }] }]
                        },
                        // Reduction reactions
                        {
                            start: 'CH‚ÇÉCOCH‚ÇÉ',
                            startName: 'Acetone',
                            target: 'CH‚ÇÉCH‚ÇÇCH‚ÇÉ',
                            targetName: 'Propane',
                            steps: [
                                { correct: 'Clemmensen reduction', options: [{ name: 'Clemmensen reduction', formula: 'Zn-Hg/HCl' }, { name: 'Wolff-Kishner', formula: 'N‚ÇÇH‚ÇÑ/KOH' }, { name: 'LiAlH‚ÇÑ', formula: 'LAH gives alcohol' }, { name: 'NaBH‚ÇÑ', formula: 'Gives alcohol' }] }
                            ]
                        },
                        {
                            start: 'C‚ÇÜH‚ÇÖCOCH‚ÇÉ',
                            startName: 'Acetophenone',
                            target: 'C‚ÇÜH‚ÇÖCH‚ÇÇCH‚ÇÉ',
                            targetName: 'Ethylbenzene',
                            steps: [{ correct: 'Wolff-Kishner reduction', options: [{ name: 'Wolff-Kishner reduction', formula: 'N‚ÇÇH‚ÇÑ/KOH, Œî' }, { name: 'Clemmensen', formula: 'Zn-Hg/HCl' }, { name: 'LiAlH‚ÇÑ', formula: 'Gives alcohol' }, { name: 'H‚ÇÇ/Pd', formula: 'Partial reduction' }] }]
                        },
                        // Hell-Volhard-Zelinsky
                        {
                            start: 'CH‚ÇÉCH‚ÇÇCOOH',
                            startName: 'Propanoic acid',
                            target: 'CH‚ÇÉCHBrCOOH',
                            targetName: 'Œ±-Bromopropanoic acid',
                            steps: [{ correct: 'HVZ reaction', options: [{ name: 'HVZ reaction', formula: 'Br‚ÇÇ/P' }, { name: 'Br‚ÇÇ/FeBr‚ÇÉ', formula: 'Aromatic bromination' }, { name: 'HBr', formula: 'Simple addition' }, { name: 'NBS', formula: 'Allylic bromination' }] }]
                        }
                    ],
                    hard: [
                        // Complex multi-step
                        {
                            start: 'C‚ÇÜH‚ÇÖCOOH',
                            startName: 'Benzoic acid',
                            target: 'C‚ÇÜH‚ÇÖCH‚ÇÉ',
                            targetName: 'Toluene',
                            steps: [
                                { correct: 'LiAlH‚ÇÑ', options: [{ name: 'LiAlH‚ÇÑ', formula: 'Reduce to alcohol' }, { name: 'NaOH/CaO', formula: 'Direct decarboxylation' }, { name: 'SOCl‚ÇÇ', formula: 'Make acyl chloride' }, { name: 'Mg/ether', formula: 'Grignard' }] },
                                { correct: 'PBr‚ÇÉ', options: [{ name: 'PBr‚ÇÉ', formula: 'Alcohol to bromide' }, { name: 'HBr', formula: 'Alternative' }, { name: 'Br‚ÇÇ', formula: 'Bromine' }, { name: 'NaBr', formula: 'Salt' }] },
                                { correct: 'Mg/ether', options: [{ name: 'Mg/ether', formula: 'Form Grignard' }, { name: 'Na/ether', formula: 'Sodium' }, { name: 'Li/ether', formula: 'Lithium' }, { name: 'Zn', formula: 'Zinc' }] },
                                { correct: 'H‚ÇÉO‚Å∫', options: [{ name: 'H‚ÇÉO‚Å∫', formula: 'Protonation' }, { name: 'NaOH', formula: 'Base' }, { name: 'H‚ÇÇO', formula: 'Water' }, { name: 'NH‚ÇÉ', formula: 'Ammonia' }] }
                            ]
                        },
                        {
                            start: 'CH‚ÇÉCH‚ÇÉ',
                            startName: 'Ethane',
                            target: 'CH‚ÇÉCH‚ÇÇOH',
                            targetName: 'Ethanol',
                            steps: [
                                { correct: 'Br‚ÇÇ/hv', options: [{ name: 'Br‚ÇÇ/hv', formula: 'Free radical halogenation' }, { name: 'Br‚ÇÇ/dark', formula: 'No reaction' }, { name: 'HBr', formula: 'Addition needs œÄ bond' }, { name: 'NaBr', formula: 'Salt' }] },
                                { correct: 'KOH(alc), Œî', options: [{ name: 'KOH(alc), Œî', formula: 'Elimination' }, { name: 'KOH(aq)', formula: 'Substitution' }, { name: 'NaCl', formula: 'Salt' }, { name: 'H‚ÇÇO', formula: 'Water' }] },
                                { correct: 'H‚ÇÇO/H‚ÇÇSO‚ÇÑ', options: [{ name: 'H‚ÇÇO/H‚ÇÇSO‚ÇÑ', formula: 'Acid-catalyzed hydration' }, { name: 'KOH/H‚ÇÇO', formula: 'Base' }, { name: 'H‚ÇÇO', formula: 'Water alone' }, { name: 'NaOH', formula: 'Hydroxide' }] }
                            ]
                        },
                        {
                            start: 'CH‚ÇÉCOOH',
                            startName: 'Acetic acid',
                            target: 'CH‚ÇÉCH‚ÇÇCOOH',
                            targetName: 'Propanoic acid',
                            steps: [
                                { correct: 'Br‚ÇÇ/P (HVZ)', options: [{ name: 'Br‚ÇÇ/P (HVZ)', formula: 'Œ±-halogenation' }, { name: 'Br‚ÇÇ/FeBr‚ÇÉ', formula: 'Aromatic' }, { name: 'HBr', formula: 'Addition' }, { name: 'NBS', formula: 'Allylic' }] },
                                { correct: 'KCN', options: [{ name: 'KCN', formula: 'Nucleophile' }, { name: 'AgCN', formula: 'Isocyanide' }, { name: 'HCN', formula: 'Weak acid' }, { name: 'NaCN', formula: 'Alternative' }] },
                                { correct: 'H‚ÇÉO‚Å∫, Œî', options: [{ name: 'H‚ÇÉO‚Å∫, Œî', formula: 'Nitrile hydrolysis' }, { name: 'NaOH', formula: 'Base hydrolysis' }, { name: 'H‚ÇÇO', formula: 'Water' }, { name: 'NH‚ÇÉ', formula: 'Ammonia' }] }
                            ]
                        },
                        {
                            start: 'C‚ÇÜH‚ÇÖNH‚ÇÇ',
                            startName: 'Aniline',
                            target: 'C‚ÇÜH‚ÇÖOH',
                            targetName: 'Phenol',
                            steps: [
                                { correct: 'NaNO‚ÇÇ/HCl, 0-5¬∞C', options: [{ name: 'NaNO‚ÇÇ/HCl, 0-5¬∞C', formula: 'Diazotization' }, { name: 'HNO‚ÇÉ/H‚ÇÇSO‚ÇÑ', formula: 'Nitration' }, { name: 'Br‚ÇÇ/FeBr‚ÇÉ', formula: 'Bromination' }, { name: 'CH‚ÇÉCOCl', formula: 'Acetylation' }] },
                                { correct: 'H‚ÇÇO, warm', options: [{ name: 'H‚ÇÇO, warm', formula: 'Diazo displacement' }, { name: 'CuCl/HCl', formula: 'Sandmeyer' }, { name: 'CuBr/HBr', formula: 'Sandmeyer Br' }, { name: 'KI', formula: 'Iodination' }] }
                            ]
                        },
                        {
                            start: 'CH‚ÇÉCHO',
                            startName: 'Acetaldehyde',
                            target: 'CH‚ÇÉCH(OH)CH(CH‚ÇÉ)CHO',
                            targetName: 'Aldol product',
                            steps: [{ correct: 'Aldol condensation (NaOH dil)', options: [{ name: 'Aldol condensation (NaOH dil)', formula: 'Base-catalyzed' }, { name: 'Cannizzaro', formula: 'No Œ±-H' }, { name: 'Clemmensen', formula: 'Reduction' }, { name: 'Friedel-Crafts', formula: 'Aromatic' }] }]
                        },
                        {
                            start: 'C‚ÇÜH‚ÇÖCOOH',
                            startName: 'Benzoic acid',
                            target: 'C‚ÇÜH‚ÇÖCONH‚ÇÇ',
                            targetName: 'Benzamide',
                            steps: [
                                { correct: 'SOCl‚ÇÇ', options: [{ name: 'SOCl‚ÇÇ', formula: 'To acyl chloride' }, { name: 'PCl‚ÇÖ', formula: 'Alternative' }, { name: 'HCl', formula: 'Weak acid' }, { name: 'Cl‚ÇÇ', formula: 'Halogen' }] },
                                { correct: 'NH‚ÇÉ', options: [{ name: 'NH‚ÇÉ', formula: 'Ammonia' }, { name: 'NaNH‚ÇÇ', formula: 'Sodium amide' }, { name: 'HNO‚ÇÉ', formula: 'Nitric acid' }, { name: 'N‚ÇÇH‚ÇÑ', formula: 'Hydrazine' }] }
                            ]
                        },
                        // Hofmann bromamide
                        {
                            start: 'CH‚ÇÉCONH‚ÇÇ',
                            startName: 'Acetamide',
                            target: 'CH‚ÇÉNH‚ÇÇ',
                            targetName: 'Methylamine',
                            steps: [{ correct: 'Hofmann bromamide', options: [{ name: 'Hofmann bromamide', formula: 'Br‚ÇÇ/KOH' }, { name: 'Gabriel synthesis', formula: 'Phthalimide' }, { name: 'LiAlH‚ÇÑ', formula: 'Reduction' }, { name: 'NaBH‚ÇÑ', formula: 'Mild reducer' }] }]
                        },
                        // Perkin reaction
                        {
                            start: 'C‚ÇÜH‚ÇÖCHO + (CH‚ÇÉCO)‚ÇÇO',
                            startName: 'Benzaldehyde + Acetic anhydride',
                            target: 'C‚ÇÜH‚ÇÖCH=CHCOOH',
                            targetName: 'Cinnamic acid',
                            steps: [{ correct: 'Perkin reaction', options: [{ name: 'Perkin reaction', formula: 'CH‚ÇÉCOONa' }, { name: 'Aldol', formula: 'NaOH' }, { name: 'Cannizzaro', formula: 'Conc. NaOH' }, { name: 'Claisen', formula: 'Base + ester' }] }]
                        },
                        // Gattermann-Koch
                        {
                            start: 'C‚ÇÜH‚ÇÜ',
                            startName: 'Benzene',
                            target: 'C‚ÇÜH‚ÇÖCHO',
                            targetName: 'Benzaldehyde',
                            steps: [{ correct: 'Gattermann-Koch', options: [{ name: 'Gattermann-Koch', formula: 'CO/HCl/AlCl‚ÇÉ' }, { name: 'Gattermann', formula: 'HCN/HCl/AlCl‚ÇÉ' }, { name: 'Reimer-Tiemann', formula: 'For phenols' }, { name: 'Friedel-Crafts', formula: 'RCOCl/AlCl‚ÇÉ' }] }]
                        },
                        // Etard reaction
                        {
                            start: 'C‚ÇÜH‚ÇÖCH‚ÇÉ',
                            startName: 'Toluene',
                            target: 'C‚ÇÜH‚ÇÖCHO',
                            targetName: 'Benzaldehyde',
                            steps: [{ correct: 'Etard reaction', options: [{ name: 'Etard reaction', formula: 'CrO‚ÇÇCl‚ÇÇ' }, { name: 'KMnO‚ÇÑ/H‚Å∫', formula: 'Over-oxidation' }, { name: 'PCC', formula: 'For alcohols' }, { name: 'K‚ÇÇCr‚ÇÇO‚Çá', formula: 'Strong oxidant' }] }]
                        },
                        // Rosenmund reduction
                        {
                            start: 'C‚ÇÜH‚ÇÖCOCl',
                            startName: 'Benzoyl chloride',
                            target: 'C‚ÇÜH‚ÇÖCHO',
                            targetName: 'Benzaldehyde',
                            steps: [{ correct: 'Rosenmund reduction', options: [{ name: 'Rosenmund reduction', formula: 'H‚ÇÇ/Pd-BaSO‚ÇÑ' }, { name: 'LiAlH‚ÇÑ', formula: 'Over-reduction' }, { name: 'NaBH‚ÇÑ', formula: 'Mild reducer' }, { name: 'Clemmensen', formula: 'Zn-Hg/HCl' }] }]
                        },
                        // Stephen reduction
                        {
                            start: 'CH‚ÇÉCN',
                            startName: 'Acetonitrile',
                            target: 'CH‚ÇÉCHO',
                            targetName: 'Acetaldehyde',
                            steps: [{ correct: 'Stephen reduction', options: [{ name: 'Stephen reduction', formula: 'SnCl‚ÇÇ/HCl' }, { name: 'LiAlH‚ÇÑ', formula: 'Over-reduction' }, { name: 'H‚ÇÉO‚Å∫', formula: 'Hydrolysis to acid' }, { name: 'NaBH‚ÇÑ', formula: 'Wrong reducer' }] }]
                        },
                        // Benzoin condensation
                        {
                            start: '2 C‚ÇÜH‚ÇÖCHO',
                            startName: '2 Benzaldehyde',
                            target: 'C‚ÇÜH‚ÇÖCH(OH)COC‚ÇÜH‚ÇÖ',
                            targetName: 'Benzoin',
                            steps: [{ correct: 'Benzoin condensation', options: [{ name: 'Benzoin condensation', formula: 'NaCN catalyst' }, { name: 'Aldol', formula: 'NaOH' }, { name: 'Cannizzaro', formula: 'Conc. base' }, { name: 'Perkin', formula: 'Anhydride' }] }]
                        },
                        // Carbylamine test
                        {
                            start: 'CH‚ÇÉNH‚ÇÇ + CHCl‚ÇÉ',
                            startName: 'Methylamine + Chloroform',
                            target: 'CH‚ÇÉNC',
                            targetName: 'Methyl isocyanide',
                            steps: [{ correct: 'Carbylamine reaction', options: [{ name: 'Carbylamine reaction', formula: 'KOH/heat' }, { name: 'Hofmann', formula: 'Br‚ÇÇ/KOH' }, { name: 'Gabriel', formula: 'Phthalimide' }, { name: 'Sandmeyer', formula: 'Diazonium' }] }]
                        },
                        // Hinsberg test
                        {
                            start: 'C‚ÇÜH‚ÇÖNH‚ÇÇ + C‚ÇÜH‚ÇÖSO‚ÇÇCl',
                            startName: 'Aniline + Benzenesulfonyl chloride',
                            target: 'C‚ÇÜH‚ÇÖNHSO‚ÇÇC‚ÇÜH‚ÇÖ',
                            targetName: 'N-phenylbenzenesulfonamide',
                            steps: [{ correct: 'Hinsberg reagent', options: [{ name: 'Hinsberg reagent', formula: 'Test for 1¬∞, 2¬∞, 3¬∞ amines' }, { name: 'Carbylamine', formula: 'CHCl‚ÇÉ/KOH' }, { name: 'Sandmeyer', formula: 'Diazonium salt' }, { name: 'Coupling', formula: 'Phenol + diazo' }] }]
                        },
                        // Beckmann rearrangement
                        {
                            start: 'C‚ÇÜH‚ÇÖCOCH‚ÇÉ oxime',
                            startName: 'Acetophenone oxime',
                            target: 'C‚ÇÜH‚ÇÖNHCOCH‚ÇÉ',
                            targetName: 'Acetanilide',
                            steps: [{ correct: 'Beckmann rearrangement', options: [{ name: 'Beckmann rearrangement', formula: 'H‚ÇÇSO‚ÇÑ or PCl‚ÇÖ' }, { name: 'Hofmann', formula: 'Br‚ÇÇ/KOH' }, { name: 'Lossen', formula: 'Hydroxamic acid' }, { name: 'Curtius', formula: 'Acyl azide' }] }]
                        },
                        // Schmidt reaction
                        {
                            start: 'C‚ÇÜH‚ÇÖCOCH‚ÇÉ + HN‚ÇÉ',
                            startName: 'Acetophenone + Hydrazoic acid',
                            target: 'C‚ÇÜH‚ÇÖNHCOCH‚ÇÉ',
                            targetName: 'Acetanilide',
                            steps: [{ correct: 'Schmidt reaction', options: [{ name: 'Schmidt reaction', formula: 'H‚ÇÇSO‚ÇÑ' }, { name: 'Beckmann', formula: 'Oxime rearrangement' }, { name: 'Hofmann', formula: 'Amide degradation' }, { name: 'Curtius', formula: 'Acyl azide' }] }]
                        },
                        // Baeyer-Villiger oxidation
                        {
                            start: 'C‚ÇÜH‚ÇÖCOCH‚ÇÉ',
                            startName: 'Acetophenone',
                            target: 'C‚ÇÜH‚ÇÖOOCCH‚ÇÉ',
                            targetName: 'Phenyl acetate',
                            steps: [{ correct: 'Baeyer-Villiger oxidation', options: [{ name: 'Baeyer-Villiger oxidation', formula: 'Peracid (m-CPBA)' }, { name: 'KMnO‚ÇÑ', formula: 'Strong oxidant' }, { name: 'K‚ÇÇCr‚ÇÇO‚Çá', formula: 'Dichromate' }, { name: 'PCC', formula: 'Mild oxidant' }] }]
                        },
                        // Birch reduction
                        {
                            start: 'C‚ÇÜH‚ÇÜ',
                            startName: 'Benzene',
                            target: '1,4-Cyclohexadiene',
                            targetName: '1,4-Cyclohexadiene',
                            steps: [{ correct: 'Birch reduction', options: [{ name: 'Birch reduction', formula: 'Na/liq. NH‚ÇÉ/EtOH' }, { name: 'H‚ÇÇ/Pt', formula: 'Full reduction' }, { name: 'LiAlH‚ÇÑ', formula: 'Hydride' }, { name: 'NaBH‚ÇÑ', formula: 'Mild reducer' }] }]
                        },
                        // Oppenauer oxidation
                        {
                            start: 'CH‚ÇÉCH‚ÇÇOH',
                            startName: 'Ethanol',
                            target: 'CH‚ÇÉCHO',
                            targetName: 'Acetaldehyde',
                            steps: [{ correct: 'Oppenauer oxidation', options: [{ name: 'Oppenauer oxidation', formula: 'Al(OiPr)‚ÇÉ/acetone' }, { name: 'PCC', formula: 'Chromium-based' }, { name: 'K‚ÇÇCr‚ÇÇO‚Çá', formula: 'Dichromate' }, { name: 'KMnO‚ÇÑ', formula: 'Permanganate' }] }]
                        },
                        // Meerwein-Ponndorf-Verley
                        {
                            start: 'CH‚ÇÉCHO',
                            startName: 'Acetaldehyde',
                            target: 'CH‚ÇÉCH‚ÇÇOH',
                            targetName: 'Ethanol',
                            steps: [{ correct: 'MPV reduction', options: [{ name: 'MPV reduction', formula: 'Al(OiPr)‚ÇÉ/iPrOH' }, { name: 'LiAlH‚ÇÑ', formula: 'LAH' }, { name: 'NaBH‚ÇÑ', formula: 'Borohydride' }, { name: 'H‚ÇÇ/Pt', formula: 'Catalytic' }] }]
                        },
                        // Swern oxidation
                        {
                            start: 'CH‚ÇÉCH‚ÇÇOH',
                            startName: 'Ethanol',
                            target: 'CH‚ÇÉCHO',
                            targetName: 'Acetaldehyde',
                            steps: [{ correct: 'Swern oxidation', options: [{ name: 'Swern oxidation', formula: '(COCl)‚ÇÇ/DMSO' }, { name: 'PCC', formula: 'Chromium' }, { name: 'DMP', formula: 'Dess-Martin' }, { name: 'TEMPO', formula: 'Nitroxyl radical' }] }]
                        }
                    ]
                };
            }

            setupSocketListeners() {
                console.log('setupSocketListeners called');
                
                // Room created
                this.socket.on('roomCreated', ({ roomCode, room }) => {
                    console.log('=== ROOM CREATED EVENT ===');
                    console.log('Room code:', roomCode);
                    console.log('Room data:', room);
                    
                    this.roomCode = roomCode;
                    this.isMultiplayer = true;
                    this.players = room.players;
                    
                    // Initialize scores for all players
                    room.players.forEach(player => {
                        this.scores[player.name] = 0;
                    });
                    
                    // Update DOM elements
                    const roomCodeEl = document.getElementById('roomCode');
                    const waitingRoomEl = document.getElementById('waitingRoom');
                    
                    console.log('roomCode element:', roomCodeEl);
                    console.log('waitingRoom element:', waitingRoomEl);
                    
                    if (roomCodeEl) {
                        roomCodeEl.textContent = `Room Code: ${roomCode}`;
                        console.log('Set room code text');
                    }
                    
                    if (waitingRoomEl) {
                        waitingRoomEl.classList.remove('hidden');
                        console.log('Removed hidden class from waiting room');
                    }
                    
                    this.updatePlayersList();
                    console.log('=== END ROOM CREATED ===');
                });

                // Player joined
                this.socket.on('playerJoined', ({ player, room }) => {
                    this.players = room.players;
                    
                    // Initialize score for new player
                    if (!this.scores[player.name]) {
                        this.scores[player.name] = 0;
                    }
                    
                    this.updatePlayersList();
                    this.showNotification(`${player.name} joined the room`);
                });

                // Player left
                this.socket.on('playerLeft', ({ playerName, room }) => {
                    this.players = room.players;
                    this.updatePlayersList();
                    this.showNotification(`${playerName} left the room`);
                });

                // Joined room successfully
                this.socket.on('joinedRoom', ({ room }) => {
                    this.roomCode = room.code;
                    this.isMultiplayer = true;
                    this.players = room.players;
                    this.difficulty = room.difficulty;
                    
                    // Initialize scores for all existing players
                    room.players.forEach(player => {
                        if (!this.scores[player.name]) {
                            this.scores[player.name] = 0;
                        }
                    });
                    
                    document.getElementById('lobbyScreen').classList.add('hidden');
                    document.getElementById('waitingRoom').classList.remove('hidden');
                    document.getElementById('roomCode').textContent = `Room Code: ${room.code}`;
                    this.updatePlayersList();
                });

                // Game started
                this.socket.on('gameStarted', ({ room }) => {
                    this.players = room.players;
                    this.difficulty = room.difficulty;
                    document.getElementById('lobbyScreen').classList.add('hidden');
                    document.getElementById('gameScreen').classList.remove('hidden');
                    this.currentRound = 0;
                    this.nextRound();
                });

                // Start round
                this.socket.on('startRound', ({ round, timestamp }) => {
                    this.currentRound = round;
                    this.timeLeft = this.timePerRound;
                    
                    // Get random question
                    const questions = this.questionBank[this.difficulty];
                    this.currentQuestion = questions[Math.floor(Math.random() * questions.length)];
                    
                    // Update UI
                    document.getElementById('roundNumber').textContent = `${this.currentRound}/${this.totalRounds}`;
                    document.getElementById('startCompound').textContent = this.currentQuestion.start;
                    document.getElementById('startCompound').nextElementSibling.textContent = this.currentQuestion.startName;
                    document.getElementById('targetCompound').textContent = this.currentQuestion.target;
                    document.getElementById('targetCompound').nextElementSibling.textContent = this.currentQuestion.targetName;
                    
                    this.currentStep = 0;
                    this.showCurrentStep();
                    this.startTimer();
                    this.updateScoreboard();
                });

                // Score update
                this.socket.on('scoreUpdate', ({ playerId, playerName, score, isCorrect, timeTaken }) => {
                    // Update local scores
                    this.scores[playerName] = score;
                    
                    // Find player and update
                    const player = this.players.find(p => p.name === playerName);
                    if (player) {
                        player.score = score;
                    }
                    
                    this.updateScoreboard();
                    
                    // Show notification
                    if (playerId !== this.socket.id) {
                        const emoji = isCorrect ? '‚úÖ' : '‚ùå';
                        this.showNotification(`${emoji} ${playerName} answered in ${timeTaken}s`);
                    }
                });

                // Waiting for players
                this.socket.on('waitingForPlayers', ({ readyCount, totalCount }) => {
                    const feedbackEl = document.getElementById('feedbackMessage');
                    feedbackEl.textContent = `Waiting for other players... (${readyCount}/${totalCount} ready)`;
                    feedbackEl.classList.remove('hidden', 'error', 'success');
                    feedbackEl.classList.add('success');
                });

                // Proceed to next round
                this.socket.on('proceedToNextRound', ({ round }) => {
                    setTimeout(() => {
                        document.getElementById('feedbackMessage').classList.add('hidden');
                    }, 2000);
                });

                // Game finished
                this.socket.on('gameFinished', ({ players }) => {
                    this.players = players;
                    this.showResults();
                });
            }

            showNotification(message) {
                const feedbackEl = document.getElementById('feedbackMessage');
                feedbackEl.textContent = message;
                feedbackEl.classList.remove('hidden', 'error', 'success');
                feedbackEl.classList.add('success');
                setTimeout(() => {
                    feedbackEl.classList.add('hidden');
                }, 3000);
            }

            showJoinRoom() {
                document.getElementById('joinRoomModal').classList.remove('hidden');
            }

            hideJoinRoom() {
                document.getElementById('joinRoomModal').classList.add('hidden');
            }

            joinRoom() {
                const playerName = document.getElementById('playerName').value.trim();
                const roomCode = document.getElementById('joinRoomCode').value.trim().toUpperCase();
                
                if (!playerName) {
                    alert('Please enter your name!');
                    return;
                }

                if (!roomCode) {
                    alert('Please enter a room code!');
                    return;
                }

                if (!this.socket || !this.socket.connected) {
                    alert('Not connected to server. Please try solo mode or refresh the page.');
                    return;
                }

                this.currentPlayer = playerName;
                this.socket.emit('joinRoom', { roomCode, playerName });
                
                // Hide join modal
                this.hideJoinRoom();
            }

            createRoom() {
                console.log('=== CREATE ROOM CLICKED ===');
                const playerName = document.getElementById('playerName').value.trim();
                console.log('Player name:', playerName);
                
                if (!playerName) {
                    alert('Please enter your name!');
                    return;
                }

                console.log('Socket status:', this.socket ? 'exists' : 'null');
                console.log('Socket connected:', this.socket ? this.socket.connected : 'N/A');
                
                if (!this.socket || !this.socket.connected) {
                    alert('Not connected to server. Please try solo mode or refresh the page.');
                    return;
                }

                this.difficulty = document.getElementById('difficultySelect').value;
                this.currentPlayer = playerName;
                this.isHost = true;
                this.isMultiplayer = true;
                
                // Initialize scores
                this.scores[playerName] = 0;

                console.log('Emitting createRoom event with:', { playerName, difficulty: this.difficulty });
                this.socket.emit('createRoom', { playerName, difficulty: this.difficulty });
                console.log('=== CREATE ROOM EVENT EMITTED ===');
            }

            createRoom() {
                const playerName = document.getElementById('playerName').value.trim();
                if (!playerName) {
                    alert('Please enter your name!');
                    return;
                }

                this.difficulty = document.getElementById('difficultySelect').value;
                this.currentPlayer = playerName;
                this.players = [{ name: playerName, score: 0, isHost: true }];
                this.scores[playerName] = 0;
                this.isHost = true;

                document.getElementById('lobbyScreen').classList.add('hidden');
                document.getElementById('waitingRoom').classList.remove('hidden');
                document.getElementById('roomCode').textContent = `Room Code: CHEM${Math.floor(Math.random() * 9000) + 1000}`;
                
                this.updatePlayersList();
            }

            quickPlay() {
                const playerName = document.getElementById('playerName').value.trim() || 'Player 1';
                this.difficulty = document.getElementById('difficultySelect').value;
                this.currentPlayer = playerName;
                this.players = [{ name: playerName, score: 0, isHost: true }];
                this.scores[playerName] = 0;
                this.isHost = true;
                this.isMultiplayer = false;

                this.startGame();
            }

            updatePlayersList() {
                const playersList = document.getElementById('playersList');
                playersList.innerHTML = this.players.map(player => `
                    <div class="player-card ${player.isHost ? 'host' : ''}">
                        <div class="player-name">${player.name}</div>
                        ${player.isHost ? '<span class="player-badge">HOST</span>' : ''}
                    </div>
                `).join('');
            }

            startGame() {
                if (this.isMultiplayer) {
                    // Emit start game event for multiplayer
                    this.socket.emit('startGame', { roomCode: this.roomCode });
                } else {
                    // Start solo game
                    document.getElementById('lobbyScreen').classList.add('hidden');
                    document.getElementById('gameScreen').classList.remove('hidden');
                    
                    this.currentRound = 0;
                    this.nextRound();
                }
            }

            nextRound() {
                if (this.currentRound >= this.totalRounds) {
                    this.showResults();
                    return;
                }

                this.currentRound++;
                this.timeLeft = this.timePerRound;
                
                if (this.isMultiplayer) {
                    // Request question from server for multiplayer
                    this.socket.emit('requestQuestion', { roomCode: this.roomCode });
                } else {
                    // Solo mode - generate question locally
                    const questions = this.questionBank[this.difficulty];
                    this.currentQuestion = questions[Math.floor(Math.random() * questions.length)];
                    
                    // Update UI
                    document.getElementById('roundNumber').textContent = `${this.currentRound}/${this.totalRounds}`;
                    document.getElementById('startCompound').textContent = this.currentQuestion.start;
                    document.getElementById('startCompound').nextElementSibling.textContent = this.currentQuestion.startName;
                    document.getElementById('targetCompound').textContent = this.currentQuestion.target;
                    document.getElementById('targetCompound').nextElementSibling.textContent = this.currentQuestion.targetName;
                    
                    // Show first step
                    this.currentStep = 0;
                    this.showCurrentStep();
                    this.startTimer();
                    this.updateScoreboard();
                }
            }

            showCurrentStep() {
                const step = this.currentQuestion.steps[this.currentStep];
                document.getElementById('stepNumber').textContent = this.currentStep + 1;
                document.getElementById('stepDescription').textContent = `Choose the correct reagent or mechanism`;
                
                // Shuffle options
                const shuffledOptions = [...step.options].sort(() => Math.random() - 0.5);
                
                const reagentOptions = document.getElementById('reagentOptions');
                reagentOptions.innerHTML = shuffledOptions.map(option => `
                    <div class="reagent-card" onclick="game.selectReagent('${option.name}')">
                        <div class="reagent-name">${option.name}</div>
                        <div class="reagent-formula">${option.formula}</div>
                    </div>
                `).join('');
            }

            selectReagent(selectedReagent) {
                const step = this.currentQuestion.steps[this.currentStep];
                const isCorrect = selectedReagent === step.correct;
                
                // Haptic feedback for mobile
                if (navigator.vibrate) {
                    navigator.vibrate(isCorrect ? [50] : [100, 50, 100]);
                }
                
                // Visual feedback
                const cards = document.querySelectorAll('.reagent-card');
                cards.forEach(card => {
                    const reagentName = card.querySelector('.reagent-name').textContent;
                    
                    // Highlight selected answer
                    if (reagentName === selectedReagent) {
                        card.classList.add(isCorrect ? 'correct' : 'incorrect');
                    }
                    
                    // If wrong answer selected, also highlight the correct answer
                    if (!isCorrect && reagentName === step.correct) {
                        card.classList.add('correct');
                        card.style.border = '3px solid #38ef7d';
                        card.style.boxShadow = '0 0 20px rgba(56, 239, 125, 0.5)';
                    }
                    
                    card.style.pointerEvents = 'none';
                });

                // Show feedback
                const feedbackEl = document.getElementById('feedbackMessage');
                feedbackEl.classList.remove('hidden', 'success', 'error');
                
                if (isCorrect) {
                    const points = Math.max(100 - (this.timePerRound - this.timeLeft) * 3, 20);
                    this.scores[this.currentPlayer] += points;
                    document.getElementById('playerScore').textContent = this.scores[this.currentPlayer];
                    feedbackEl.textContent = `üéâ Correct! +${points} points`;
                    feedbackEl.classList.add('success');
                    
                    // Emit score update for multiplayer
                    if (this.isMultiplayer) {
                        this.socket.emit('submitAnswer', {
                            roomCode: this.roomCode,
                            isCorrect: true,
                            timeTaken: this.timePerRound - this.timeLeft,
                            points: points
                        });
                    }
                    
                    setTimeout(() => {
                        feedbackEl.classList.add('hidden');
                        this.currentStep++;
                        
                        if (this.currentStep < this.currentQuestion.steps.length) {
                            this.showCurrentStep();
                        } else {
                            clearInterval(this.timer);
                            
                            if (this.isMultiplayer) {
                                // Signal ready for next round
                                this.socket.emit('playerReady', { roomCode: this.roomCode });
                            } else {
                                setTimeout(() => this.nextRound(), 1500);
                            }
                        }
                    }, 1500);
                } else {
                    feedbackEl.innerHTML = `‚ùå Incorrect! The correct answer is: <strong style="color: #38ef7d;">${step.correct}</strong>`;
                    feedbackEl.classList.add('error');
                    
                    // Emit score update for multiplayer
                    if (this.isMultiplayer) {
                        this.socket.emit('submitAnswer', {
                            roomCode: this.roomCode,
                            isCorrect: false,
                            timeTaken: this.timePerRound - this.timeLeft,
                            points: 0
                        });
                    }
                    
                    setTimeout(() => {
                        feedbackEl.classList.add('hidden');
                        clearInterval(this.timer);
                        
                        if (this.isMultiplayer) {
                            this.socket.emit('playerReady', { roomCode: this.roomCode });
                        } else {
                            setTimeout(() => this.nextRound(), 1500);
                        }
                    }, 3000);
                }

                this.updateScoreboard();
            }

            startTimer() {
                clearInterval(this.timer);
                const timerFill = document.getElementById('timerFill');
                const timeLeftEl = document.getElementById('timeLeft');
                
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    const percentage = (this.timeLeft / this.timePerRound) * 100;
                    timerFill.style.width = percentage + '%';
                    timeLeftEl.textContent = this.timeLeft + 's';
                    
                    if (this.timeLeft <= 10) {
                        timerFill.classList.add('warning');
                    }
                    
                    if (this.timeLeft <= 0) {
                        clearInterval(this.timer);
                        
                        if (this.isMultiplayer) {
                            this.socket.emit('playerReady', { roomCode: this.roomCode });
                            const feedbackEl = document.getElementById('feedbackMessage');
                            feedbackEl.textContent = 'Time up! Waiting for other players...';
                            feedbackEl.classList.remove('hidden', 'error', 'success');
                            feedbackEl.classList.add('error');
                        } else {
                            this.nextRound();
                        }
                    }
                }, 1000);
            }

            updateScoreboard() {
                const liveScores = document.getElementById('liveScores');
                
                // Sort players by score
                const sortedPlayers = [...this.players].sort((a, b) => {
                    const scoreA = this.scores[a.name] || a.score || 0;
                    const scoreB = this.scores[b.name] || b.score || 0;
                    return scoreB - scoreA;
                });
                
                liveScores.innerHTML = sortedPlayers.map(player => {
                    const playerScore = this.scores[player.name] || player.score || 0;
                    return `
                        <div class="score-item ${player.name === this.currentPlayer ? 'current-player' : ''}">
                            <span class="score-name">${player.name}</span>
                            <span class="score-value">${playerScore}</span>
                        </div>
                    `;
                }).join('');
            }

            showResults() {
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('resultsScreen').classList.remove('hidden');
                
                // Sort players by final score
                const sortedPlayers = [...this.players].sort((a, b) => {
                    const scoreA = this.scores[a.name] || a.score || 0;
                    const scoreB = this.scores[b.name] || b.score || 0;
                    return scoreB - scoreA;
                });
                
                const podium = document.getElementById('podium');
                const places = ['first', 'second', 'third'];
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                
                podium.innerHTML = sortedPlayers.slice(0, 3).map((player, index) => {
                    const playerScore = this.scores[player.name] || player.score || 0;
                    return `
                        <div class="podium-place ${places[index]}">
                            <div class="place-number">${medals[index]}</div>
                            <div class="place-name">${player.name}</div>
                            <div class="place-score">${playerScore} points</div>
                        </div>
                    `;
                }).join('');
            }

            returnToLobby() {
                location.reload();
            }

            installApp() {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('App installed');
                        }
                        deferredPrompt = null;
                        document.getElementById('installBtn').classList.add('hidden');
                    });
                }
            }

            testSocket() {
                console.log('=== TESTING SOCKET CONNECTION ===');
                
                if (!this.socket) {
                    alert('‚ùå Socket not initialized');
                    return;
                }
                
                if (!this.socket.connected) {
                    alert('‚ùå Socket not connected. Status: ' + this.socket.io.readyState);
                    return;
                }
                
                alert('‚úÖ Socket is connected!\nID: ' + this.socket.id + '\nNow testing server communication...');
                
                // Test sending a message to server
                this.socket.emit('testMessage', { test: 'ping', timestamp: Date.now() });
                
                // Wait for response
                this.socket.once('testResponse', (data) => {
                    alert('‚úÖ Server responded!\n' + JSON.stringify(data));
                });
                
                // Timeout after 3 seconds
                setTimeout(() => {
                    alert('‚ö†Ô∏è No response from server after 3 seconds. Check server logs.');
                }, 3000);
            }
        }

        // Initialize game after DOM and socket are ready
        let game;
        window.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded');
            
            // Small delay to ensure socket is initialized
            setTimeout(() => {
                try {
                    game = new ChemRaceGame();
                    console.log('Game initialized');
                    
                    // Hide loading, show content
                    const loadingIndicator = document.getElementById('loadingIndicator');
                    const lobbyContent = document.getElementById('lobbyContent');
                    
                    if (loadingIndicator) loadingIndicator.style.display = 'none';
                    if (lobbyContent) lobbyContent.style.display = 'block';
                } catch (error) {
                    console.error('Game initialization error:', error);
                    const loadingIndicator = document.getElementById('loadingIndicator');
                    if (loadingIndicator) {
                        loadingIndicator.innerHTML = '<div style="color: #f5576c;">Error loading game. Please refresh the page.</div>';
                    }
                }
            }, 200);
        });
    </script>
</body>
</html>